<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤±è½çš„å­¦ç”Ÿ - æƒ…ç»ªå¤„ç†æ•™å­¦ç‰ˆ</title>
    <style>
        :root {
            --bg-dark: #1a1a2e;
            --panel-bg: rgba(255, 255, 255, 0.08);
            --text-main: #e0e0e0;
            --accent-blue: #3498db;
            --accent-green: #2ecc71;
            --accent-red: #e74c3c;
            --accent-warm: #d35400;
        }

        body, html {
            margin: 0;
            padding: 0; height: 100%;
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background-color: var(--bg-dark); color: var(--text-main);
            overflow: hidden;
        }

        #game-interface { display: none;
            height: 100vh; width: 100vw; transition: background 1.5s ease;
        }

        #main-view { flex: 3;
            display: flex; flex-direction: column; padding: 40px; position: relative;
        }
        #level-indicator { font-size: 14px;
            color: var(--accent-blue); letter-spacing: 2px; margin-bottom: 10px;
        }
        #scene-title { font-size: 28px; margin-bottom: 20px;
            font-weight: bold;
        }

        #visual-canvas {
            flex-grow: 1;
            background: #0f3443; border-radius: 20px;
            display: flex; justify-content: center; align-items: flex-start; /* å·²ä¿®å¤ï¼šç”± center æ”¹ä¸º flex-start é˜²æ­¢å†…å®¹æº¢å‡ºé®æŒ¡ */
            position: relative; overflow-y: auto; padding: 20px;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.1);
        }

        #student-avatar { font-size: 18px; text-align: left; line-height: 1.8; max-width: 90%; padding-top: 10px; /* å·²ä¿®å¤ï¼šå¢åŠ é¡¶éƒ¨å¡«å…… */
        }
        #action-area { height: 280px; display: flex; flex-direction: column; justify-content: center; gap: 12px;
            margin-top: 20px; }

        .choice-btn {
            background: var(--panel-bg);
            border: 1px solid rgba(255,255,255,0.2);
            color: white; padding: 15px 20px; border-radius: 10px;
            text-align: left; cursor: pointer; transition: all 0.3s;
            font-size: 15px;
            width: 100%;
        }
        .choice-btn:hover:not(:disabled) { background: rgba(255,255,255,0.2); transform: translateX(10px); border-color: var(--accent-blue);
        }
        .choice-btn:disabled { opacity: 0.6; cursor: not-allowed;
        }

        .feedback-box {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px; padding: 25px;
            margin-top: 10px; border-left: 5px solid var(--accent-green);
        }

        .reason-title { 
            color: var(--accent-green);
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 24px;
            border-bottom: 2px solid rgba(46, 204, 113, 0.3);
            padding-bottom: 5px;
            display: inline-block;
        }
        .reason-content { 
            font-size: 18px;
            line-height: 1.8;
            color: #ffffff;
            white-space: pre-line;
        }

        #status-sidebar {
            flex: 1;
            background: rgba(0,0,0,0.3); padding: 30px;
            display: flex; flex-direction: column; gap: 25px;
            border-left: 1px solid rgba(255,255,255,0.1);
        }
        .status-item { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 12px;
        }
        .status-label { font-size: 13px; color: #888; margin-bottom: 10px; display: flex; justify-content: space-between;
        }
        .progress-bg { width: 100%; height: 6px; background: #333; border-radius: 3px;
        }
        .progress-fill { height: 100%; border-radius: 3px;
            transition: width 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275); }

        .filter-warm { background-color: #3e2723 !important;
        }
        .filter-red { background-color: #421010 !important;
        }

        #system-toast {
            position: fixed;
            top: 20px; left: 50%; transform: translateX(-50%);
            padding: 12px 30px; border-radius: 50px; display: none; z-index: 3000;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .overlay {
            position: fixed;
            inset: 0; background: var(--bg-dark);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 2000; padding: 40px;
        }

        #instruction-overlay { text-align: left;
            align-items: flex-start; max-width: 800px; margin: 0 auto;
            overflow-y: auto; }
        .rule-card { background: rgba(255,255,255,0.05);
            padding: 20px; border-radius: 15px; margin-bottom: 20px;
            width: 100%; box-sizing: border-box; }
        .rule-card h3 { color: var(--accent-blue); margin-top: 0;
            border-bottom: 1px solid rgba(52, 152, 219, 0.3); padding-bottom: 8px; }
        .rule-card p { font-size: 15px;
            line-height: 1.6; margin: 10px 0; }
        .highlight { color: var(--accent-green); font-weight: bold;
        }
    </style>
</head>
<body>

<div id="system-toast">æç¤ºå†…å®¹</div>

<div id="start-overlay" class="overlay">
    <h1 style="font-size: 48px; margin-bottom: 10px;">å¤±è½çš„å­¦ç”Ÿ</h1>
    <p style="color: #888; margin-bottom: 40px;">â€”â€” å”¯æœ‰çµé­‚çš„å…±é¸£ï¼Œæ–¹èƒ½å¼€å¯ç´§é—­çš„å¿ƒé—¨ â€”â€”</p>
    <button class="choice-btn" style="width: 200px; text-align: center;"
onclick="showInstructions()">æŒ‘æˆ˜æ•™å­¦</button>
</div>

<div id="instruction-overlay" class="overlay" style="display: none;">
    <div style="max-width: 700px; margin: 0 auto;">
        <h2 style="text-align: center; color: var(--accent-green); margin-bottom: 30px;">ğŸ“– æ¸¸æˆä½¿ç”¨è¯´æ˜ä¹¦</h2>
        
        <div class="rule-card">
            <h3>ç¬¬ä¸€éƒ¨åˆ†ï¼šæ¸¸æˆè§„åˆ™</h3>
            <p>â€¢ <b>èƒŒæ™¯è®¾å®š</b>ï¼šä½ å°†æ‰®æ¼”ä¸€åæ•™å¸ˆï¼Œé¢å¯¹å› è€ƒè¯•å´©æºƒè€Œç´§é—­å¿ƒé—¨çš„ Samanthaã€‚</p>
            <p>â€¢ <b>æ ¸å¿ƒç›®æ ‡</b>ï¼šä½ éœ€è¦é€šè¿‡å››æ¬¡å…³é”®æŠ‰æ‹©ï¼ŒåŒ–è§£ Samantha çš„å¿ƒç†å±æœºï¼Œè·å¾—æœ€ç»ˆçš„ <span class="highlight">â€œçµé­‚æ•æ‰‹â€</span> å‹‹ç« ã€‚</p>
            <p>â€¢ <b>æˆåŠŸåˆ¤å®š</b>ï¼šåªæœ‰å½“å¸ˆç”Ÿä¿¡ä»»åº¦è¾¾åˆ° <span class="highlight">100%</span> æ—¶æ‰è§†ä¸ºæŒ‘æˆ˜æˆåŠŸã€‚ä»»ä½•ä½äºæ­¤åˆ†æ•°çš„ç»“å±€å‡è§†ä¸ºæŒ‘æˆ˜å¤±è´¥ã€‚</p>
        </div>

  
      <div class="rule-card">
            <h3>ç¬¬äºŒéƒ¨åˆ†ï¼šé€šå…³åŸåˆ™ä¸æ ¸å¿ƒåŠ¨ä½œ</h3>
            <p>åœ¨åšå‡ºé€‰é¡¹å‰ï¼Œè¯·åŠ¡å¿…ç†è§£æ¯ä¸€å…³çš„æ ¸å¿ƒé€»è¾‘ï¼š</p>
            <p>1.
<b>æš‚åœÂ·æ¥çº³</b>ï¼šæƒ…ç»ªå´©æºƒæ—¶ï¼Œæ ¸å¿ƒåŠ¨ä½œæ˜¯<span class="highlight">ç«‹å³åœæ­¢æ•™å­¦</span>ï¼Œå…è®¸æ²‰é»˜å’Œå“­æ³£ã€‚</p>
            <p>2.
<b>åˆ†äº«Â·å…±æƒ…</b>ï¼šæ ¸å¿ƒåŠ¨ä½œæ˜¯<span class="highlight">åˆ†äº«çœŸå®çš„è„†å¼±ç»å†</span>ï¼Œé€šè¿‡æ·±åº¦å…±é¸£é©±æ•£å­¦ç”Ÿçš„å­¤ç‹¬æ„Ÿã€‚</p>
            <p>3.
<b>é‡æ„Â·è½¬è¯‘</b>ï¼šæ ¸å¿ƒåŠ¨ä½œæ˜¯æ•æ‰åŠªåŠ›è¯æ®ï¼Œå°†èƒ½åŠ›é—®é¢˜<span class="highlight">è½¬è¯‘ä¸ºç­–ç•¥æˆ–å…¶ä»–é—®é¢˜</span>ï¼Œç§»é™¤ç¾è€»æ„Ÿã€‚</p>
            <p>4.
<b>èµ‹èƒ½Â·é‡å¯</b>ï¼šæ ¸å¿ƒåŠ¨ä½œæ˜¯<span class="highlight">é¢ è¦†å¤±è´¥çš„æ„ä¹‰</span>ï¼Œå°†è€ƒè¯•å®šä¹‰ä¸ºå¯»æ‰¾é—æ¼çš„å·¥å…·è€Œéèƒ½åŠ›çš„å®¡åˆ¤ã€‚</p>
        </div>

        <button class="choice-btn" style="width: 100%; text-align: center; margin-top: 20px; background: var(--accent-green);"
onclick="beginGame()">æˆ‘å·²é˜…è¯»å¹¶ç†è§£è§„åˆ™ï¼Œå¼€å§‹æŒ‘æˆ˜</button>
    </div>
</div>

<div id="game-interface">
    <div id="main-view">
        <div id="level-indicator">LEVEL 01</div>
        <div id="scene-title">æ¸¸æˆåŠ è½½ä¸­...</div>
        <div id="visual-canvas">
            <div id="student-avatar">æ­£åœ¨æ¥å…¥ Samantha çš„è¿œç¨‹ä¼šè®®ç»ˆç«¯...</div>
        </div>
        <div id="action-area"></div>
    </div>

    <div id="status-sidebar">
        <h3 style="margin-top: 0;">Samantha çš„çŠ¶æ€</h3>
        <div class="status-item">

            <div class="status-label">æƒ…ç»ªå‹åŠ› <span id="val-stress">95%</span></div>
            <div class="progress-bg"><div id="bar-stress" class="progress-fill" style="background: var(--accent-red); width: 95%;"></div></div>
        </div>
        <div class="status-item">
            <div class="status-label">å¸ˆç”Ÿä¿¡ä»»åº¦ <span id="val-trust">60%</span></div>
            <div class="progress-bg"><div id="bar-trust" class="progress-fill" style="background: var(--accent-green); width: 60%;"></div></div>
        </div>
       
<div class="status-item">
            <div class="status-label">å¿ƒå¢™åšåº¦ <span id="val-wall">100%</span></div>
            <div class="progress-bg"><div id="bar-wall" class="progress-fill" style="background: #95a5a6;
width: 100%;"></div></div>
        </div>
        <div class="status-item">
            <div class="status-label">çŸ¥è¯†å¸æ”¶ç‡ <span id="val-absorb">0%</span></div>
            <div class="progress-bg"><div id="bar-absorb" class="progress-fill" style="background: var(--accent-blue);
width: 0%;"></div></div>
        </div>
        <div style="margin-top: auto;
color: #555;">
            è·ç¦»ä¸‹è¯¾è¿˜æœ‰: <span id="timer" style="color: #aaa;">30:00</span>
        </div>
    </div>
</div>

<script>
    let state = {
        level: 1,
        stress: 95,
        trust: 60,
        wall: 100,
        absorb: 0,
        time: 30,
        isGameOver: false,

        history: [] // è®°å½•æ¯å…³çš„é€‰æ‹©
    };

    const scriptData = {
        1: {
            title: "ç¬¬ä¸€å…³ï¼šé»„é‡‘ 3 ç§’çš„æŠ‰æ‹©",
            desc: "Samantha åŸ‹ç€å¤´ï¼Œè‚©è†€å‰§çƒˆåœ°æŠ–åŠ¨ç€ï¼Œæ³ªæ°´ä¸€æ»´æ»´è½åœ¨è¯•å·ä¸Šï¼Œä¸€é˜µé˜µæŠ½æ³£å£°ä¼ åˆ°è€å¸ˆçš„è€³æœµé‡Œã€‚",
            correctReason: `ã€ç¬¬ä¸€æ­¥ æš‚åœÂ·æ¥çº³ã€‘ï¼ˆæŒ‰ä¸‹æš‚åœé”®ï¼Œåˆ›é€ å®‰å…¨å®¹å™¨ï¼‰\nåŸåˆ™ï¼šæƒ…ç»ªå´©æºƒæ—¶ï¼Œè®¤çŸ¥è„‘å·²å®•æœºã€‚é¦–è¦ä»»åŠ¡æ˜¯åœæ­¢æ–½å‹ï¼Œæä¾›æ— æ¡ä»¶çš„æƒ…æ„Ÿæ¥çº³ã€‚\nå…³é”®åŠ¨ä½œï¼š\n1. ç«‹å³æš‚åœï¼šé€šè¿‡åŠ¨ä½œè¡¨æ˜â€œæ­¤åˆ»ï¼Œä½ æ¯”è¯¾ç¨‹æ›´é‡è¦â€ã€‚\n2. è¯­è¨€é”šå®šï¼šä½¿ç”¨â€œè€å¸ˆå¬å¾—å‡ºä½ ç°åœ¨å¾ˆéš¾å—â€è¿›è¡Œæƒ…ç»ªç¡®è®¤ã€‚\n3. å…è®¸å­˜åœ¨ï¼šç»™äºˆæ²‰é»˜å’Œå“­æ³£çš„ç©ºé—´ã€‚\nç¦å¿Œï¼šæ€¥äºè§£å†³é—®é¢˜ã€è¯´æ•™ã€å¦å®šæƒ…ç»ªã€‚`,
            options: [
          
      { text: "[ A ] â€œSamanthaï¼Œå…ˆæ”¶æ”¶æƒ…ç»ªã€‚æ¨¡æ‹Ÿè€ƒçš„æ„ä¹‰å°±æ˜¯å‘ç°é—®é¢˜ï¼Œå“­è§£å†³ä¸äº†é—®é¢˜ã€‚è¿™é“å‡ ä½•å‹è½´é¢˜éå¸¸å…³é”®ï¼Œæˆ‘ä»¬æŠŠå®ƒè®²å®Œï¼ŒåŒ–æ‚²æ„¤ä¸ºåŠ›é‡ã€‚â€", type: "bad", feedback: "ä¸¥é‡çš„å…±æƒ…ç¼ºå¤±ï¼ä¿¡ä»»å€¼å¤§å¹…è·Œè½ã€‚" },
                { text: "[ B ] â€œåˆ«å“­å•¦ï¼Œè¿™ç‚¹å°äº‹ä¸å€¼å¾—å“ˆï¼Œæˆ‘å½“å¹´æ¨¡è€ƒæ•°å­¦ä¹Ÿå¾ˆå·®ï¼Œæˆ‘ä¸ä¹ŸæŒºè¿‡æ¥äº†å—ï¼Ÿå’±ä»¬åšå¼ºç‚¹ã€‚â€", type: "neutral", feedback: "æ— æ•ˆå®‰æ…°ï¼Œå¥¹æ„Ÿåˆ°äº†è¢«æ•·è¡ã€‚" },
                { text: "[ C ] â€œSamanthaï¼Œè€å¸ˆå¬å¾—å‡ºä½ å¾ˆéš¾å—ã€‚æˆ‘ä»¬è¿™èŠ‚è¯¾å…ˆæš‚åœï¼Œæˆ‘é™ªä½ é™é™å¾…ä¼šå„¿ã€‚â€", type: "good", feedback: "æ­£ç¡®ï¼šä½ çš„è€å¿ƒåˆæ­¥æ¾åŠ¨äº†å¥¹çš„å¿ƒå¢™ã€‚" }
            ]
        },
        2: {
   
         title: "ç¬¬äºŒå…³ï¼šéš”ç©ºçš„å®ˆå€™",
            desc: "ç©ºæ°”é™é»˜äº†ä¸€åˆ†é’Ÿã€‚Samantha åœæ­¢äº†æŠ½æ³£ï¼Œä½†ä¾ç„¶æ²¡æœ‰å¼€å£ï¼Œåå¤æŠ˜å è¯•å·ã€‚",
            correctReason: `ã€ç¬¬äºŒæ­¥ï¼šåˆ†äº«Â·å…±æƒ…ã€‘ï¼ˆæ·±åº¦å…±é¸£ï¼Œé©±æ•£å­¤ç‹¬æ„Ÿï¼‰\nåŸåˆ™ï¼šé€šè¿‡é€‚åº¦å…±æƒ…ï¼Œè®©å­¦ç”Ÿæ„Ÿåˆ°â€œæˆ‘ä¸æ˜¯ä¸€ä¸ªäººâ€ï¼Œå»ºç«‹æƒ…æ„Ÿè”ç»“ã€‚\nå…³é”®åŠ¨ä½œï¼š\n1. åˆ†äº«è„†å¼±ï¼šåˆ†äº«è‡ªå·±çœŸå®çš„ã€å¤±è´¥ç»å†ã€‚ \n2. æè¿°æ„Ÿå—ï¼šå¸®åŠ©å­¦ç”Ÿç†è§£å¹¶ç¡®è®¤è‡ªå·±çš„æƒ…ç»ªã€‚\n3. æ·±åº¦è”ç»“ï¼šå°†å¸ˆç”Ÿç½®äºæƒ…æ„Ÿå…±åŒä½“ä¸­ã€‚\nç¦å¿Œï¼šè™šå‡å®‰æ…°ã€æ³›æ³›è€Œè°ˆã€å¡‘é€ å®Œç¾å½¢è±¡ã€‚`,
            options: [
                { text: "[ A ] â€œæ„Ÿè§‰å¥½ç‚¹äº†å—ï¼Ÿæˆ‘ä»¬çš„è¿›åº¦å·²ç»è½åäº†ï¼Œç¦»ä¸‹è¯¾è¿˜æœ‰ 20 åˆ†é’Ÿï¼Œå“ªæ€•è®²ä¸€åŠä¹Ÿå¥½ï¼Œæˆ‘ä»¬å…ˆæŠŠè¿™ç»„ä¸‰è§’å‡½æ•°å…¬å¼è¿‡ä¸€éã€‚â€", type: "bad", feedback: "æ€¥èºçš„æ•™å­¦èŠ‚å¥å½»åº•ç ´åäº†åˆšå»ºç«‹çš„ä¿¡ä»»ã€‚" },
                { text: "[ B ] â€œSamanthaï¼Œä½ æ˜¯ä¸æ˜¯æœ€è¿‘å‹åŠ›å¤ªå¤§ï¼Ÿè¿˜æ˜¯è§‰å¾—æˆ‘è®²è¯¾çš„æ–¹å¼å¬ä¸æ‡‚ï¼Ÿè·Ÿæˆ‘è¯´è¯´ï¼Œè€å¸ˆçœ‹æœ‰ä»€ä¹ˆèƒ½å¸®åˆ°ä½ ã€‚â€", type: "neutral", feedback: "è¿‡åº¦çš„è¯¢é—®è®©å¥¹å†æ¬¡é™·å…¥æ²‰é»˜ã€‚" },
                { text: "[ C ] â€œå…¶å®çœ‹ç€ä½ éš¾å—æˆ‘ä¹ŸæŒºå¿ƒç–¼ã€‚æˆ‘ä»¥å‰è€ƒç ¸äº†ä¹Ÿä¼šèº²èµ·æ¥å“­ï¼Œé‚£ç§â€˜åŠªåŠ›äº†å´æ²¡ç»“æœâ€™çš„æ— åŠ›æ„Ÿï¼Œç¡®å®å¾ˆéš¾å—ã€‚â€", type: "good", feedback: "è‡ªæˆ‘æš´éœ²çš„åŠ›é‡ï¼å¥¹æ„Ÿå—åˆ°äº†å¹³ç­‰çš„å…±æƒ…ã€‚" }
   
         ]
        },
        3: {
            title: "ç¬¬ä¸‰å…³ï¼šé€»è¾‘çš„ç¼éš™",
            desc: "å¥¹ç»ˆäºå¼€å£ï¼Œå£°éŸ³æ²™å“‘ï¼šâ€œæˆ‘æ˜¯ä¸æ˜¯çœŸçš„å¾ˆç¬¨ï¼Ÿå¤ä¹ åˆ°å‡Œæ™¨ä¸¤ç‚¹ï¼Œå¯ä¸€ä¸Šè€ƒåœºè„‘å­é‡Œå°±æˆäº†è’æ¼ ã€‚â€",
            correctReason: `ã€ç¬¬ä¸‰æ­¥ï¼šé‡æ„Â·è½¬è¯‘ã€‘ï¼ˆè®¤çŸ¥å‡ç»´ï¼Œæ”¹å˜é—®é¢˜è§†è§’ï¼‰\nåŸåˆ™ï¼šç”¨æ–°çš„â€œæ€ç»´æ¨¡å‹â€æ›¿æ¢å­¦ç”Ÿæ¶ˆæçš„è‡ªæˆ‘è®¤çŸ¥ã€‚\nå…³é”®åŠ¨ä½œï¼š\n1. æ•æ‰å…³é”®ï¼šæŠ“ä½å­¦ç”Ÿè¯è¯­ä¸­çš„â€œåŠªåŠ›è¯æ®â€ã€‚\n2. é‡æ–°å®šä¹‰ï¼šå°†é—®é¢˜ä»â€œèƒ½åŠ›ç¼ºé™·â€å‡ç»´ä¸ºâ€œç”Ÿç†æˆ–ç­–ç•¥é—®é¢˜â€ï¼Œç§»é™¤ç¾ç¾è€»æ„Ÿã€‚\nç¦å¿Œï¼šç©ºæ´é¼“åŠ±ï¼ˆâ€œä½ å¾ˆèªæ˜â€ï¼‰ã€ç›´æ¥åé©³ï¼ˆâ€œä½ æ‰ä¸ç¬¨â€ï¼‰ã€‚`,
            options: [
                { text: "[ A ] â€œä½ åªæ˜¯å¤ªç´§å¼ äº†ï¼Œåˆ«çæƒ³ã€‚ä½ çš„æ™ºå•†ç»å¯¹æ²¡é—®é¢˜ï¼Œä¸‹æ¬¡åªè¦å¿ƒæ€ç¨³ä½ï¼Œä¸€å®šèƒ½å‘æŒ¥å¥½ã€‚ä½ è¦å¯¹è‡ªå·±æœ‰ä¿¡å¿ƒï¼â€", type: "bad", feedback: "å¦å®šå¥¹çš„ç—›è‹¦ï¼ˆ'åˆ«çæƒ³'ï¼‰æ˜¯æœ€å±é™©çš„æ²Ÿé€šæ–¹å¼ã€‚" },
                { text: "[ B ] â€œä½ å½“æ—¶æ˜¯å®Œå…¨æ²¡æ€è·¯ï¼Œè¿˜æ˜¯åœ¨è®¡ç®—çš„æ—¶å€™å¡ä½äº†ï¼Ÿè€å¸ˆå¸®ä½ ä¸€èµ·çœ‹çœ‹é‚£äº›è®©ä½ å¡å£³çš„é¢˜ï¼Œä¸‹æ¬¡ä¸å‡ºé”™å°±å¥½äº†ã€‚â€", type: "neutral", feedback: "ä¾ç„¶åœç•™åœ¨è§£å†³é—®é¢˜å±‚é¢ï¼Œè€Œéæƒ…æ„Ÿå±‚é¢ã€‚" },
                { text: "[ C ] â€œå‡Œæ™¨ä¸¤ç‚¹ï¼Ÿé‚£æ˜¯å¤§è„‘åœ¨ç–²æƒ«çŠ¶æ€ä¸‹çš„è‡ªæˆ‘ä¿æŠ¤ã€‚å°±å¥½æ¯”æ‰‹æœºæ²¡ç”µäº†é»‘å±ï¼Œè¿™ä¸æ˜¯ä½ ç¬¨ï¼Œè€Œæ˜¯å®ƒéœ€è¦ä¼‘æ¯ã€‚â€", type: "good", feedback: "å»ç½ªåŒ–æˆåŠŸï¼å¥¹æ”¾ä¸‹äº†å¯¹è‡ªæˆ‘çš„æ”»å‡»ã€‚" }
       
     ]
        },
        4: {
            title: "ç¬¬å››å…³ï¼šå¤±è½çš„æ‹¼å›¾ (ç»ˆå±€)",
            desc: "å¥¹æƒ…ç»ªå¹³å¤äº†å¾ˆå¤šï¼Œä½†å°å£°é—®ï¼šâ€œè€å¸ˆï¼Œé‚£å¦‚æœä¸‹å‘¨æ¨¡æ‹Ÿâ€¦â€¦æˆ‘è¿˜æ˜¯è€ƒç ¸äº†æ€ä¹ˆåŠï¼Ÿâ€",
            correctReason: `ã€ç¬¬å››æ­¥ï¼šèµ‹èƒ½Â·é‡å¯ã€‘ï¼ˆè¡ŒåŠ¨é”šå®šï¼ŒæŒ‡å‘æœªæ¥å¸Œæœ›ï¼‰\nåŸåˆ™ï¼šå°†æ–°çš„è®¤çŸ¥è½¬åŒ–ä¸ºé¢å‘æœªæ¥çš„ã€å…·ä½“çš„è¡ŒåŠ¨è§†è§’ï¼Œæ³¨å…¥å¸Œæœ›ã€‚\nå…³é”®åŠ¨ä½œï¼š\n1. æ¥çº³æœ€åå‡è®¾ï¼šä¸å¦è®¤å¤±è´¥çš„å¯èƒ½æ€§ã€‚\n2. é¢ è¦†æ„ä¹‰æ¡†æ¶ï¼šç”¨ç§¯æéšå–»ï¼Œé¢ è¦†â€œè€ƒè¯•â€çš„ææ€–å™äº‹ã€‚\n3. èµ‹äºˆæ–°ä½¿å‘½ï¼šå°†ææƒ§è½¬åŒ–ä¸ºä¸»åŠ¨æ¢ç´¢çš„åŠ¨åŠ›ã€‚\nç¦å¿Œï¼šè™šå‡ä¿è¯ï¼ˆâ€œä½ ä¸‹æ¬¡ä¸€å®šè€ƒå¥½â€ï¼‰ã€æ¯ç‡¥çš„æ–¹æ³•è¯´æ•™ã€‚`,
            options: [
                { text: "[ A ] â€œåˆ«æ€•ï¼Œæ¥ä¸‹æ¥çš„æ¯ä¸€å¤©æˆ‘éƒ½ä¼šç»™ä½ åŠ ç»ƒã€‚åªè¦ä½ æŒ‰æˆ‘ç»™ä½ çš„è®¡åˆ’èµ°ï¼Œæˆ‘ä¿è¯ä½ çš„æˆç»©ä¼šç¨³æ­¥å›å‡ã€‚â€", type: "neutral", feedback: "è´Ÿè´£ä»»ä½†ç¼ºä¹çµé­‚çš„å¼•å¯¼ã€‚" },
                { text: "[ B ] â€œè€ƒç ¸äº†å°±å†æ¥ã€‚è€ƒè¯•æœ¬èº«å°±æ˜¯ä¸€ç§æŠ—å‹æµ‹è¯•ã€‚å¦‚æœä½ è¿æ¨¡æ‹Ÿéƒ½å®³æ€•ï¼Œé‚£è€ƒè¯•ä½ æ€ä¹ˆåŠï¼Ÿâ€", type: "bad", feedback: "æœ€åæ—¶åˆ»çš„å›é©¬æªï¼å¥¹å½»åº•å´©æºƒã€‚" },
                { text: "[ C ] â€œé‚£å°±å¤ªå¥½äº†ã€‚æ¨¡æ‹Ÿæ˜¯ç”¨æ¥æ‰¾é—æ¼çš„ï¼Œå‘ç°çš„é—®é¢˜è¶Šå¤šï¼Œå’±ä»¬åŠªåŠ›çš„æ–¹å‘å°±è¶Šæ˜ç¡®ã€‚â€", type: "good", feedback: "å®Œç¾çš„è§†è§’è½¬åŒ–ï¼" }
      
      ]
        }
    };

 function updateUI() {
        const clamp = (val) => Math.min(Math.max(val, 0), 100);
document.getElementById('val-stress').innerText = clamp(state.stress) + "%";
        document.getElementById('bar-stress').style.width = clamp(state.stress) + "%";
        document.getElementById('val-trust').innerText = clamp(state.trust) + "%";
        document.getElementById('bar-trust').style.width = clamp(state.trust) + "%";
document.getElementById('val-wall').innerText = clamp(state.wall) + "%";
        document.getElementById('bar-wall').style.width = clamp(state.wall) + "%";
        document.getElementById('val-absorb').innerText = clamp(state.absorb) + "%";
        document.getElementById('bar-absorb').style.width = clamp(state.absorb) + "%";
document.getElementById('timer').innerText = state.time + ":00";
    }

    function showToast(msg, isGood) {
        const toast = document.getElementById('system-toast');
toast.innerText = msg;
        toast.style.background = isGood ? "var(--accent-green)" : "var(--accent-red)";
        toast.style.display = "block";
        setTimeout(() => toast.style.display = "none", 3000);
}

    function renderLevel() {
        if (state.isGameOver || state.level > 4) return;
const data = scriptData[state.level];
        document.getElementById('level-indicator').innerText = "LEVEL 0" + state.level;
        document.getElementById('scene-title').innerText = data.title;
        document.getElementById('student-avatar').innerText = data.desc;
        const actionArea = document.getElementById('action-area');
actionArea.innerHTML = "";
        data.options.forEach((opt) => {
            const btn = document.createElement('button');
            btn.className = "choice-btn";
            btn.innerText = opt.text;
            btn.onclick = () => handleChoice(opt);
            actionArea.appendChild(btn);
        });
}

    function handleChoice(opt) {
        if(state.isGameOver) return;
        const data = scriptData[state.level];
// è®°å½•é€‰æ‹©å†å²ç”¨äºæœ€åæ€»ç»“
        state.history.push({
            level: state.level,
            text: opt.text,
            type: opt.type,
            feedback: opt.feedback
        });
const container = document.getElementById('game-interface');
        if (opt.type === "good") {
            container.className = "filter-warm";
state.trust += 12; state.stress -= 15; state.wall -= 25; state.absorb += 15;
            showToast("é€‰æ‹©æ­£ç¡®ï¼", true);
} else if (opt.type === "bad") {
            container.className = "filter-red";
state.trust -= 40; state.stress += 20; state.wall += 30;
            showToast("é€‰æ‹©ä¸ä½³ï¼", false);
} else {
            container.className = "";
            state.trust -= 25;
state.stress += 5;
            showToast("ååº”å¹³å¹³...", false);
        }
        state.time -= 5;
        updateUI();
if (state.trust <= 0) {
            state.isGameOver = true;
setTimeout(() => {
                const summary = summarizeErrors();
                endGame("æŒ‘æˆ˜å¤±è´¥ï¼ç»“å±€ï¼šã€å†°å†·çš„é™Œç”Ÿäººã€‘", summary); 
            }, 1000);
return;
        }
        showDeepAnalysis(opt, data);
}

    function showDeepAnalysis(userOpt, levelData) {
        const actionArea = document.getElementById('action-area');
const avatar = document.getElementById('student-avatar');
        actionArea.innerHTML = "";
        let analysisHtml = `<div class="feedback-box">`;
if (userOpt.type !== "good") {
            const correctOpt = levelData.options.find(o => o.type === "good");
// é€»è¾‘é¡ºåºï¼š1. é”™è¯¯åé¦ˆ 2. æ­£ç¡®é€‰é¡¹ 3. åŸå› è§£é‡Š
            analysisHtml += `<div style="color:var(--accent-red); margin-bottom:10px; font-weight:bold;">âŒ é”™è¯¯åé¦ˆï¼š${userOpt.feedback}</div>`;
analysisHtml += `<div style="color:var(--accent-green); margin-bottom:15px; font-size:16px;">ğŸ’¡ æ­£ç¡®é€‰é¡¹åº”è¯¥æ˜¯ï¼š<br>${correctOpt.text}</div>`;
        } else {
            analysisHtml += `<div style="color:var(--accent-green); margin-bottom:15px; font-size:16px;">âœ¨ å®Œç¾å…±æƒ…ï¼${userOpt.feedback}</div>`;
}
        
        analysisHtml += `<div class="reason-title">ä¸ºä»€ä¹ˆè¿™æ˜¯æ­£ç¡®åŠ¨ä½œï¼Ÿ</div><div class="reason-content">${levelData.correctReason}</div></div>`;
avatar.innerHTML = analysisHtml;
        avatar.parentElement.scrollTop = 0;

        const nextBtn = document.createElement('button');
        nextBtn.className = "choice-btn";
        nextBtn.disabled = true;
        actionArea.appendChild(nextBtn);
let timeLeft = 10;
        const timerId = setInterval(() => {
            nextBtn.innerText = `æ·±åº¦å¸æ”¶ä¸­... (${timeLeft}s)`;
            timeLeft--;
            if (timeLeft < 0) {
                clearInterval(timerId);
                nextBtn.innerText = state.level >= 4 ? "æŸ¥çœ‹æœ€ç»ˆè¯„ä»·" : "è¿›å…¥ä¸‹ä¸€å…³";
       
        nextBtn.disabled = false;
                nextBtn.style.borderColor = "var(--accent-green)";
                nextBtn.onclick = () => {
                    state.level++;
                    document.getElementById('game-interface').className = "";
         
          if (state.level > 4) { calculateEnd(); } else { renderLevel(); }
                };
            }
        }, 1000);
}

    function summarizeErrors() {
        const errors = state.history.filter(h => h.type !== 'good');
if (errors.length === 0) return "ä½ åœ¨æ¯ä¸€å…³éƒ½åšå‡ºäº†å®Œç¾çš„å…±æƒ…æŠ‰æ‹©ã€‚";
        
        let html = `<div style="margin-top:20px; border-top:1px solid rgba(255,255,255,0.1); padding-top:10px;">`;
        html += `<h4 style="color:var(--accent-red)">é”™è¯¯é€‰é¡¹å›é¡¾ï¼š</h4>`;

errors.forEach(e => {
            html += `<p style="font-size:14px; margin-bottom:8px;"><span style="color:var(--accent-blue)">Level 0${e.level}:</span> ${e.feedback}</p>`;
        });
html += `</div>`;
        return html;
    }

    function calculateEnd() {
        let result = "";
let status = "æŒ‘æˆ˜å¤±è´¥ï¼";
        const summary = summarizeErrors();

        if (state.trust >= 100) {
            status = "æŒ‘æˆ˜æˆåŠŸï¼";
result = "ã€çµé­‚æ•æ‰‹ã€‘\nå”¯æœ‰å®Œç¾çš„å…±æƒ…ï¼Œæ‰èƒ½æ¢æ¥æ­¤åˆ»çš„æ•‘èµã€‚ä½ æˆä¸ºäº†å¥¹ç”Ÿå‘½é‡Œçš„å…‰ã€‚";
            endGame(status + "\n" + result, "");
        } else {
            if (state.trust > 60) {
                result = "ã€è´Ÿè´£çš„è®²å¸ˆã€‘\nè¯¾ç¨‹é¡ºåˆ©ç»“æŸï¼Œä½†ä½ åªæ˜¯ä¸€ä¸ªè·¯è¿‡å¥¹ç”Ÿå‘½å¹¶æä¾›å¸®åŠ©çš„é™Œç”Ÿäººã€‚ä½ æœªèƒ½åœ¨å…±æƒ…ä¸Šè¾¾åˆ°æè‡´ã€‚";
} else {
                result = "ã€çŸ¥è¯†çš„æ¬è¿å·¥ã€‘\nå¥¹å‹‰å¼ºå¬å®Œäº†è¯¾ï¼Œä½†å¯¹ä½ çš„ä¿¡ä»»å·²é™è‡³å†°ç‚¹ã€‚ä½ çš„å…±æƒ…èƒ½åŠ›å°šå¾…ç£¨ç‚¼ã€‚";
}
            endGame(status + "\n" + result, summary);
}
    }

    function endGame(title, summary) {
        const avatar = document.getElementById('student-avatar');
const actionArea = document.getElementById('action-area');
        
        avatar.innerHTML = `
            <div style="text-align:center;">
                <h2 style="font-size:32px; color:${title.includes('æˆåŠŸ') ? 'var(--accent-green)' : 'var(--accent-red)'}">${title.split('\n')[0]}</h2>
                <p style="font-size:18px; margin:20px 0; line-height:1.6;">${title.split('\n')[1] || ''}</p>
                ${summary}
            </div>
        `;
        
        actionArea.innerHTML = `
            <button class="choice-btn" style="text-align:center; background:var(--accent-green); border:none;" 
            onclick="location.reload()">å†æ¬¡æŒ‘æˆ˜</button>
        `;
    }

    function showInstructions() {
        document.getElementById('start-overlay').style.display = "none";
        document.getElementById('instruction-overlay').style.display = "flex";
    }

    function beginGame() {
        document.getElementById('instruction-overlay').style.display = "none";
        document.getElementById('game-interface').style.display = "flex";
        updateUI();
        renderLevel();
    }
</script>

</body>
</html>